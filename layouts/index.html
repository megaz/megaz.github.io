<!doctype html>
<html lang="en">
  {{ partial "head.html" . }}
<body>
  <a class="skip-link" href="#main">Skip to main</a>
  <main id="main">
    <div class="content">
      {{ partial "header.html" . }}
      {{ .Content }}
      {{ if gt (len ( where .Site.RegularPages "Section" "posts" )) 0 }}
      <h1>Latest Posts</h1>
      <section>
        {{ range (first .Site.Params.items (where .Site.RegularPages "Section" "posts" ).ByDate.Reverse) }}
          <article style="margin:2rem 0; display:flex; gap:1rem; align-items:flex-start;">
            {{/* If page-bundle image exists, process it; else use the static path */}}
            {{ $img := (cond (and .Params.featured_image (ne (printf "%T" (.Params.featured_image)) "<nil>")) (.Resources.GetMatch .Params.featured_image) nil) }}
            {{ if $img }}
              {{ $thumb := $img.Fill "400x225 center" }}
              <a href="{{ .RelPermalink }}"><img src="{{ $thumb.RelPermalink }}" alt="{{ .Title }}" width="{{ $thumb.Width }}" height="{{ $thumb.Height }}" style="max-width:200px; border-radius:8px;"></a>
            {{ else if .Params.featured_image }}
              <a href="{{ .RelPermalink }}"><img src="{{ .RelPermalink | replaceRE "/$" "" }}/../{{ .Params.featured_image }}" alt="{{ .Title }}" style="max-width:200px; border-radius:8px;"></a>
            {{ end }}

            <div>
              <h2 style="margin:0 0 .25rem 0; font-size:1.2rem;"><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
              <time class="g time" datetime="{{ dateFormat "2006-01-02" .Date }}">{{ dateFormat "2006-01-02" .Date }}</time>
              <p style="margin:0.5rem 0 0 0;">{{ .Summary | default (.Plain | truncate 150) }}</p>
            </div>
          </article>
        {{ end }}
      </section>
      {{ end }}
    </div>
  </main>
</body>
</html>
